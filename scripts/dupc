#!/bin/bash

# Th∆∞ m·ª•c c·∫•u h√¨nh
ROFI_DIR="$HOME/.config/rofi"
WAYBAR_DIR="$HOME/.config/waybar"

# 1. H·ªñ TR·ª¢ L·ªÜNH HELP
if [[ "$1" == "help" || -z "$1" ]]; then
    echo "--------------------------------------------------------"
    echo "üöÄ DUPC - TR√åNH QU·∫¢N L√ù THEME TO√ÄN DI·ªÜN"
    echo "--------------------------------------------------------"
    echo "1. ƒê·ªïi theme cho App Launcher (SUPER + Space):"
    echo "   üëâ dupc theme rofi <name.rasi>"
    echo ""
    echo "2. ƒê·ªïi theme cho File Browser (SUPER + F):"
    echo "   üëâ dupc theme rofi_file <name_file.rasi>"
    echo ""
    echo "3. ƒê·ªïi theme cho Waybar:"
    echo "   üëâ dupc theme waybar <name.css>"
    echo ""
    echo "üí° M·∫πo: C√≥ th·ªÉ g√µ t√™n file c√≥ ho·∫∑c kh√¥ng c√≥ ƒëu√¥i m·ªü r·ªông."
    echo "--------------------------------------------------------"
    exit 0
fi

# 2. PH√ÇN T√çCH LO·∫†I THEME (R·∫Ω nh√°nh ch√≠nh x√°c)
ACTION=$1
TYPE=$2
THEME_RAW=$3

if [[ "$ACTION" == "theme" ]]; then
    
    # X·ª¨ L√ù WAYBAR
    if [[ "$TYPE" == "waybar" ]]; then
        THEME_NAME="${THEME_RAW%.css}"
        SOURCE_STYLE="$WAYBAR_DIR/themes/$THEME_NAME.css"
        TARGET_STYLE="$WAYBAR_DIR/style.css"

        if [ -f "$SOURCE_STYLE" ]; then
            ln -sf "$SOURCE_STYLE" "$TARGET_STYLE"
            pkill -USR2 waybar
            echo "‚úÖ Waybar ƒë√£ chuy·ªÉn sang theme: $THEME_NAME"
            exit 0
        else
            echo "‚ùå Kh√¥ng t√¨m th·∫•y: $SOURCE_STYLE"
            exit 1
        fi

    # X·ª¨ L√ù ROFI (APP & FILE)
    elif [[ "$TYPE" == "rofi" || "$TYPE" == "rofi_file" ]]; then
        THEME_NAME="${THEME_RAW%.rasi}"
        SOURCE_THEME="$ROFI_DIR/$THEME_NAME.rasi"
        
        if [[ "$TYPE" == "rofi_file" ]]; then
            TARGET_LINK="$ROFI_DIR/current_file_theme.rasi"
            MSG="File Browser"
        else
            TARGET_LINK="$ROFI_DIR/current_theme.rasi"
            MSG="App Launcher"
        fi

        if [ -f "$SOURCE_THEME" ]; then
            ln -sf "$SOURCE_THEME" "$TARGET_LINK"
            echo "‚úÖ ƒê√£ c·∫≠p nh·∫≠t $MSG sang theme: $THEME_NAME"
            exit 0
        else
            echo "‚ùå L·ªói: Kh√¥ng t√¨m th·∫•y $SOURCE_THEME"
            exit 1
        fi
    else
        echo "‚ùå Lo·∫°i theme '$TYPE' kh√¥ng h·ª£p l·ªá! (D√πng: rofi, rofi_file, waybar)"
        exit 1
    fi
else
    echo "‚ùå Sai c√∫ ph√°p! G√µ 'dupc help' ƒë·ªÉ xem h∆∞·ªõng d·∫´n."
    exit 1
fi
